```{r fig.height=12}
library(dplyr)
library(cowplot)
library(patchwork)
io = import('io')

config = io$read_yaml("../../config.yaml")
aneup = io$load("../../data/aneup.RData")

df = lapply(aneup$estimate[config$cohorts], reshape2::melt) %>%
    bind_rows(.id="cohort") %>%
    mutate(chrs = factor(chrs, levels=c(1:22,'X')))

ng = sapply(aneup$sets, length) %>%
    stack() %>%
    transmute(ng=values, chrs=ind) %>%
    inner_join(distinct(df[c("cohort", "chrs")]))

y_labels = seq_along(levels(df$chrs))
y_labels[(y_labels-1) %% 5 != 0 | y_labels > 20] = ""
y_labels[length(y_labels)] = "X"

p1 = ggplot(df) +
    geom_vline(xintercept=2:3, linetype="dotted", color="grey") +
    ggstance::geom_boxploth(aes(x=value, y=chrs, fill=cohort),
                            outlier.shape=1, outlier.size=0.2, outlier.alpha=0.5) +
    facet_grid(cohort ~ ., scales="free", space="free_y") +
    guides(fill=FALSE) +
    scale_x_continuous(trans="log2", breaks=2:3) +
    scale_y_discrete(labels=y_labels) +
    labs(x = "Ploidy (number of chromosomes)",
         y = "Chromosome")

p2 = ggplot(ng) +
    ggstance::geom_barh(aes(x=ng, y=chrs, fill=cohort), color="darkgrey", stat="identity") +
    facet_grid(cohort ~ ., scales="free", space="free_y") +
    guides(fill=FALSE) +
    scale_y_discrete(labels=y_labels) +
    labs(x = "# genes") +
    theme(axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank(),
          axis.line.y = element_blank(),
          strip.background = element_blank(),
          strip.text = element_blank())

p1 + p2 + plot_layout(nrow=1, widths=c(5, 1)) & theme(plot.margin = unit(c(0,0,0,0), "cm"))
```
