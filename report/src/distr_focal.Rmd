```{r fig.height=12}
library(dplyr)
library(cowplot)
library(patchwork)
io = import('io')

config = io$read_yaml("../../config.yaml")
focal = io$load("../../data/focal.RData")

df = lapply(focal$estimate[config$cohorts], reshape2::melt) %>%
    bind_rows(.id="cohort") %>%
    mutate(name = sub("[A-Z]+", "", name),
           name = factor(name, levels=gtools::mixedsort(unique(name))))

ng = lapply(focal$sets[config$cohorts], function(x) sapply(x, length)) %>%
    lapply(stack) %>%
    bind_rows(.id = "cohort") %>%
    transmute(cohort=cohort, ng=values, name=sub("[A-Z]+", "", ind)) %>%
    filter(paste(cohort, name) %in% paste(df$cohort, df$name))

y_labels = seq_along(levels(df$name))
y_labels[(y_labels-1) %% 5 != 0] = ""

p1 = ggplot(df) +
    geom_vline(xintercept=1:9, linetype="dotted", color="grey") +
    ggstance::geom_boxploth(aes(x=value, y=name, fill=cohort),
                            outlier.shape=1, outlier.size=0.2, outlier.alpha=0.5) +
    facet_grid(cohort ~ ., scales="free", space="free_y") +
    guides(fill=FALSE) +
    scale_x_continuous(trans="log2", breaks=1:9) +
    scale_y_discrete(labels=y_labels) +
    labs(x = "DNA copies of segment",
         y = "Regions of focal amplification/deletion (RACS)")

p2 = ggplot(ng) +
    ggstance::geom_barh(aes(x=ng, y=name, fill=cohort), color="darkgrey", stat="identity") +
    facet_grid(cohort ~ ., scales="free", space="free_y") +
    guides(fill=FALSE) +
    scale_x_continuous(trans="log2") +
    scale_y_discrete(labels=y_labels) +
    labs(x = "# genes") +
    theme(axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank(),
          axis.line.y = element_blank(),
          strip.background = element_blank(),
          strip.text = element_blank())

p1 + p2 + plot_layout(nrow=1, widths=c(5, 1)) & theme(plot.margin = unit(c(0,0,0,0), "cm"))
```
